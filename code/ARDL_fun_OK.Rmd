---
title: "Explore ARDL function"
author: "Lionel Roger"
date: "14/07/2020"
output: html_document
---

```{r setup, include=FALSE}
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE)
library("tidyverse")
library("sjPlot")

source("ARDL_fun.R")

```

## ARDL function

This report is meant to explore the functionality of the ARDL.flex function and provide an overview over its output.

The function is documented in [ARDL_fun.Rd](ARDL_fun.Rd); currently this file needs to be opened in RStudio seperately and then opened using "Preview".

## Data

We will employ data for the maximum period where data is available on Movement (google) and Stringency (Oxford Tracker) at the country level. The function can however be employed for any other set of variables and at any other level of aggregation.

```{r load data, echo = TRUE}
# Prepare dataset (take differences, drop unnecessary variables and missing observations)
df.now <- read_rds("../df_covid_long.rds") %>%
  filter(City == "") %>%
  group_by(Country) %>%
  mutate(diff.Movement = c(NA, diff(Movement)),
         diff.StringencyIndex = c(NA, diff(StringencyIndex))) %>%
  dplyr::select(Country, Date, diff.Movement, diff.StringencyIndex, Movement, StringencyIndex) %>%
  drop_na()


```

```{r}
list5<-ARDL.flex(data.input = df.now,depvar="diff.Movement",indepvar ="diff.StringencyIndex" ,max.p=3,max.q=3,by.var="Country")

longR<-list5$summary[,c("ObsUnit","LongRunCoefficient")]

load("ARDL-output.RData")

longR2<-output.ardl$summary[,c("ObsUnit","LongRunCoefficient")]


means<-df.now%>%
  group_by(Country)%>%
  summarise(Move=mean(Movement),SI=mean(StringencyIndex))

means$LR<-longR2$LongRunCoefficient

#source("Weather_new/combining_Cities.r")

Countries<-gwmp%>%
  filter(!is.na(City),!is.na(Movement),!is.na(TEMP))%>%
  group_by(Country)%>%
  summarise(Country=first(Country),city=first(City))


short<-df.now%>%
  filter(Country %in% Countries$Country)

shortR<-longR2%>%
  filter(ObsUnit%in%short$Country)%>%
  rename(Country=ObsUnit)


short<-left_join(short,shortR,by="Country")

meansSh<- short%>%
  group_by(Country)%>%
  summarise(Move=mean(Movement),SI=mean(StringencyIndex),LR=mean(LongRunCoefficient))

```


