filter(Country %in% Countries$Country)
shortR<-output.ardl$summary[,c("ObsUnit","LongRunCoefficient")]
shortR<-longR2%>%
filter(ObsUnit%in%short$Country   )
short$LongR<-shortR$LongRunCoefficient
shortR<-longR2%>%
filter(ObsUnit%in%short$Country)%>%
rename(Country=ObsUnit)
short<-left_join(short,shortR,by="Country")
list5<-ARDL.flex(data.input = df.now,depvar="diff.Movement",indepvar ="diff.StringencyIndex" ,max.p=3,max.q=3,by.var="Country")
longR<-list5$summary[,c("ObsUnit","LongRunCoefficient")]
load("ARDL-output.RData")
longR2<-output.ardl$summary[,c("ObsUnit","LongRunCoefficient")]
means<-df.now%>%
group_by(Country)%>%
summarise(Move=mean(Movement),SI=mean(StringencyIndex))
means$LR<-longR2$LongRunCoefficient
#source("Weather_new/combining_Cities.r")
Countries<-gwmp%>%
filter(!is.na(City),!is.na(Movement),!is.na(TEMP))%>%
group_by(Country)%>%
summarise(Country=first(Country),city=first(City))
short<-df.now%>%
filter(Country %in% Countries$Country)
shortR<-longR2%>%
filter(ObsUnit%in%short$Country)%>%
rename(Country=ObsUnit)
short<-left_join(short,shortR,by="Country")
meansSh<- group_by(Country)%>%
summarise(Move=mean(Movement),SI=mean(StringencyIndex),LR=mean(LongRunCoefficient))
meansSh<- group_by(Country)%>%
summarise(Move=mean(Movement),SI=mean(StringencyIndex),LR=mean(LongRunCoefficient))
short<-left_join(short,shortR,by="Country")
meansSh<- group_by(Country)%>%
summarise(Move=mean(Movement),SI=mean(StringencyIndex),LR=mean(LongRunCoefficient))
meansSh<- short%>%
group_by(Country)%>%
summarise(Move=mean(Movement),SI=mean(StringencyIndex),LR=mean(LongRunCoefficient))
short<-df.now%>%
filter(Country %in% Countries$Country)
shortR<-longR2%>%
filter(ObsUnit%in%short$Country)%>%
rename(Country=ObsUnit)
short<-left_join(short,shortR,by="Country")
meansSh<- short%>%
group_by(Country)%>%
summarise(Move=mean(Movement),SI=mean(StringencyIndex),LR=mean(LongRunCoefficient))
View(meansSh)
library(tidyverse)
library(stringr)
library(lmerTest)
library(stargazer)
library(mfx)
library(knitr)
library(kSamples)
library(FSA)
library(kableExtra)
library(xtable)
library(miceadds)
library(jtools)
library(plm)
library(clubSandwich)
library(ggrepel)
library(sjPlot)
library(sjmisc)
library(sjlabelled)
library(naniar)
library(ggpubr)
library(lubridate)
#source("ImportLong.r")
source("Weather_new/combining_Cities.r")
#source("ImportLong.r")
#source("Weather_new/combining_Cities.r")
write_rds(gwmp,"GWMP.rds")
getwd()
#source("ImportLong.r")
#source("Weather_new/combining_Cities.r")
#write_rds(gwmp,"GWMP.rds")
gwmp<-readRDS("GWMP.rds")
source("Google/import_mobility.r")
rm(loc,cities)
gwmp<-gwmp%>%
group_by(Country)
gwmp$Continent<- countrycode(sourcevar = gwmp$Country,
origin = "country.name",
destination = "continent")
city_short<-gwmp%>%
filter(!is.na(Movement),!is.na(risktaking),!is.na(Temp_C))%>%
group_by(Country,City)%>%
summarise(
across(where(is.numeric), mean),
across(where(is.factor), first),
across(where(is.character), first),
n = n())
city_short<-gwmp%>%
filter(!is.na(Movement),!is.na(risktaking),!is.na(Temp_C))%>%
group_by(Country,City)%>%
summarise(
across(where(is.numeric), mean),
across(where(is.factor), first),
across(where(is.character), first),
n = n())
country_short<-city_short%>%
group_by(Country)%>%
summarise(
across(where(is.numeric), mean),
across(where(is.factor), first),
across(where(is.character), first),
n = n())
gwmp2<-gwmp%>%
group_by(Country,City,Date)%>%
summarise_all(first)
?summarise_at()
gwmp2<-gwmp%>%
group_by(Country,City,Date)%>%
summarise_at(Country:Continent,.funs(first))
gwmp2<-gwmp%>%
group_by(Country,City,Date)%>%
summarise_each(first)
gwmp2<-gwmp%>%
group_by(Country,City,Date)%>%
summarise_all(first)
write_rds(gwmp2,"GWMP2.rds")
#write_rds(gwmp2,"GWMP2.rds")
gwmp2<-readRDS("GWMP2.rds")
city100<-city_short%>%filter(n>=100)
gwmp2<-gwmp2%>% filter(City %in% city100$City)
city_short2<-gwmp2%>%
ungroup()%>%
group_by(Country,City)%>%
summarise(
across(where(is.numeric), mean),
across(where(is.factor), first),
across(where(is.character), first),
n = n())
nrow(city100)
nrow(city_short2)
View(city_short2)
View(city100)
gwmp2<-gwmp2%>% filter(City %in% city100$City)%>%
filter(Country %in% city100$Country)
city_short2<-gwmp2%>%
ungroup()%>%
group_by(Country,City)%>%
summarise(
across(where(is.numeric), mean),
across(where(is.factor), first),
across(where(is.character), first),
n = n())
#write_rds(gwmp2,"GWMP2.rds")
gwmp2<-readRDS("GWMP2.rds")
city100<-city_short%>%filter(n>=100)
gwmp2<-gwmp2%>% filter(City %in% city100$City)
gwmp2<-gwmp2%>% filter(City %in% city100$City)%>%
filter(Country %in% city100$Country)
city_short2<-gwmp2%>%
ungroup()%>%
group_by(Country,City)%>%
summarise(
across(where(is.numeric), mean),
across(where(is.factor), first),
across(where(is.character), first),
n = n())
DT::datatable(
city_short2%>%
dplyr::select(Country,City,Temp_C,risktaking, patience, Movement, population,n)
)
View(city_short2)
city_short2<-gwmp2%>%
ungroup()%>%
group_by(Country,City)%>%
summarise(
across(where(is.numeric), mean(na.rm=T)),
across(where(is.factor), first),
across(where(is.character), first),
n = n())
city_short2<-gwmp2%>%
ungroup()%>%
group_by(Country,City)%>%
summarise(
across(where(is.numeric), mean,na.rm=T),
across(where(is.factor), first),
across(where(is.character), first),
n = n())
View(city_short2)
DT::datatable(
city_short2%>%
dplyr::select(Country,City,Temp_C,risktaking, patience, Movement, population,n)
)
#write_rds(gwmp2,"GWMP2.rds")
gwmp3<-readRDS("GWMP2.rds")
gwmp3<-gwmp3%>%
group_by(City)
gwmp3%>%
group_by(City)%>%
summarise(Count = n())
length(unique(gwmp3$City))
We go from `length(unique(gwmp3$City))`, the total amount of observations goes down to 60 thousands from 260 thousands...
length(unique(gwmp3$City))
cor.test(gwmp2$Movement,gwmp2$Temp_C)
cor.test(gwmp2$Movement,gwmp2$Temp_C,method="spearman")
View(gwmp2)
x<-gwmp2%>%
dplyr::select(Country,City,Date,Rain,PRCP)
gwmp2$PRCP[1]
gwmp2$PRCP[100]
gwmp2$PRCP[10000]
summary(gwmp2$PRCP)
x<-gwmp2%>%
dplyr::select(Country,City,Date,Rain,PRCP)
View(x)
x<-gwmp2%>%
dplyr::select(Country,City,Date,Rain,PRCP)%>%
filter(na.rm=T)
x<-gwmp2%>%
dplyr::select(Country,City,Date,Rain,PRCP)%>%
na.omit()
View(x)
cor.test(x$Rain,x$PRCP)
?substr
as.numeric(substr("FRSHTT", 1, 1))
substr("FRSHTT", 1, 1))
substr("FRSHTT", 1, 1)
substr("FRSHTT", 2, 2)
summary(gwmp2$PRCP)
gwmp2$Rain2<-ifelse(gwmp2$PRCP>0,1,0)
summary(gwmp2$Rain2)
cor.test(gwmp2$Movement,gwmp2$Rain2)
cor.test(gwmp2$Movement,gwmp2$Rain2,method="spearman")
cor.test(gwmp2$Movement,gwmp2$PRCP)
cor.test(gwmp2$Movement,gwmp2$PRCP,method="spearman")
modelsTemp<-gwmp2%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C, data = .x)))
View(modelsTemp)
modelsPRCP<-gwmp2%>%
filter(!is.na(PRCP_Cm),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ PRCP, data = .x)))
modelsPRCP<-gwmp2%>%
filter(!is.na(PRCP),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ PRCP, data = .x)))
m1<-modelsTemp%>%filter(term=="(Intercept)")%>%dplyr::select(estimate)%>%rename(Intercept_Temp=estimate)
m2<-modelsTemp%>%filter(term=="Temp_C")%>%dplyr::select(estimate,p.value)%>%rename(Temp_C_coef=estimate)
m3<-modelsPRCP%>%filter(term=="(Intercept)")%>%dplyr::select(estimate)%>%rename(Intercept_PRCP=estimate)
m4<-modelsPRCP%>%filter(term=="PRCP_Cm")%>%dplyr::select(estimate,p.value)%>%rename(PRCP_Cm_coef=estimate)
m34<-left_join(m3,m4,by=c("Country"))
m12<-left_join(m1,m2,by=c("Country"))
models<-left_join(m12,m34,by=c("Country"))
models[,-1]<-round(models[,-1],3)
DT::datatable(models)
modelsTemp<-gwmp2%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+Temp_C^2, data = .x)))
View(modelsTemp)
modelsTemp<-gwmp2%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+Temp_C^2, data = .x)))
modelsTemp<-gwmp2%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C,Temp_C^2, data = .x)))
gwmp2$Temp_C_sq<-gwmp2$Temp_C^2
modelsTemp<-gwmp2%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+Temp_C_sq, data = .x)))
View(modelsTemp)
source("OxfordTracking/covid-policy-tracker-master/data/import_OxCGRT.R")
summary(Ox$Date)
summary(mobility_regional$date)
summary(mobility$date)
df<-left_join(gwmp2,Ox,by=c("Country","Date"))
modelsTempSI<-df%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+Temp_C_sq+StringencyIndex, data = .x)))
View(modelsTempSI)
View(modelsTemp)
medn1<-modelsTemp%>%
filter(term=="Temp_C")%>%
dplyr::select(estimate)
summary(medn1)
medn2<-modelsTempSI%>%
filter(term=="Temp_C")%>%
dplyr::select(estimate)
summary(medn2)
modelsTemp<-gwmp2%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country,City)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+Temp_C_sq, data = .x)))
View(modelsTemp)
modelsPRCP<-gwmp2%>%
filter(!is.na(PRCP),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ PRCP, data = .x)))
modelsTempSI<-df%>%
filter(!is.na(PRCP),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ PRCP+StringencyIndex, data = .x)))
modelsPRCP_SI<-df%>%
filter(!is.na(PRCP),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ PRCP+StringencyIndex, data = .x)))
modelsTempSI<-df%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+Temp_C_sq+StringencyIndex, data = .x)))
View(modelsPRCP)
mednR1<-modelsPRCP%>%
filter(term=="PRCP")%>%
dplyr::select(estimate)
summary(mednR1)
mednR2<-modelsPRCP_SI%>%
filter(term=="PRCP")%>%
dplyr::select(estimate)
summary(mednR2)
modelsPRCP<-gwmp2%>%
filter(!is.na(PRCP),!is.na(Movement))%>%
group_by(Country,City)%>%
group_modify(~ broom::tidy(lm(Movement ~ PRCP, data = .x)))
modelsPRCP_SI<-df%>%
filter(!is.na(PRCP),!is.na(Movement))%>%
group_by(Country,City)%>%
group_modify(~ broom::tidy(lm(Movement ~ PRCP+StringencyIndex, data = .x)))
mednR1<-modelsPRCP%>%
filter(term=="PRCP")%>%
dplyr::select(estimate)
summary(mednR1)
mednR2<-modelsPRCP_SI%>%
filter(term=="PRCP")%>%
dplyr::select(estimate)
summary(mednR2)
View(df)
View(Ox)
cor.test(Ox$ConfirmedCases,Ox$StringencyIndex)
cor.test(Ox$ConfirmedCases,Ox$StringencyIndex,method="spearman")
cor.test(log(Ox$ConfirmedCases),Ox$StringencyIndex)
df$ConfirmedCases
modelsTempSI<-df%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+Temp_C_sq+StringencyIndex+ConfirmedCases, data = .x)))
View(modelsTempSI)
df$logCase<-log(df$ConfirmedCases+1)
modelsTempSI<-df%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+Temp_C_sq+StringencyIndex+logCase, data = .x)))
View(modelsTempSI)
medn1<-modelsTemp%>%
filter(term=="logCase")%>%
dplyr::select(estimate)
summary(medn1)
medn1<-modelsTempSI%>%
filter(term=="logCase")%>%
dplyr::select(estimate)
modelsTempSI<-df%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country,City)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+Temp_C_sq+StringencyIndex+logCase, data = .x)))
medn1<-modelsTempSI%>%
filter(term=="logCase")%>%
dplyr::select(estimate)
summary(medn1)
modelsTempSI<-df%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+Temp_C_sq+StringencyIndex+logCase, data = .x)))
medn1<-modelsTempSI%>%
filter(term=="logCase")%>%
dplyr::select(estimate)
summary(medn1)
modelsTempSI<-df%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country,City)%>%
group_modify(~ broom::tidy(lm(Movement ~ logCase, data = .x)))
medn1<-modelsTemp%>%
filter(term=="logCase")%>%
dplyr::select(estimate)
summary(medn1)
medn1<-modelsTempSI%>%
filter(term=="logCase")%>%
dplyr::select(estimate)
summary(medn1)
modelsTempSI<-df%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country,City)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+Temp_C_sq+StringencyIndex+PRCP+ logCase, data = .x)))
medn1<-modelsTempSI%>%
filter(term=="logCase")%>%
dplyr::select(estimate)
summary(medn1)
pval<-modelsTempSI%>%
filter(p.value>0.1)
View(pval)
pval<-modelsTempSI%>%
filter(p.value<0.1)
View(pval)
pval%>%
group_by(term)%>%
summarise(count())
modelsTempSI%>%
group_by(term)%>%
summarise(count(p.value<0.1))
modelsTempSI%>%
group_by(term)%>%
summarise(tally(p.value<0.1))
modelsTempSI%>%
group_by(term)%>%
tally(p.value<0.1)
p<-modelsTempSI%>%
group_by(term)%>%
tally(p.value<0.1)
View(p)
p<-modelsTempSI%>%
group_by(term)%>%
tally(p.value<0.05)
View(p)
pval<-modelsTempSI%>%
filter(p.value<0.05)%>%
group_by(term)%>%
summarise_all(median)
pval<-modelsTempSI%>%
filter(p.value<0.05)%>%
group_by(term)%>%
summarise_all(first)
pval<-modelsTempSI%>%
filter(p.value<0.05)%>%
group_by(term)%>%
summarise_all(.funs(median))
pval<-modelsTempSI%>%
filter(p.value<0.05)%>%
group_by(term)
View(pval)
pval<-modelsTempSI%>%
filter(p.value<0.05)%>%
group_by(term)%>%
summarise(EstMed=median(estimate))
View(pval)
pval<-modelsTempSI%>%
filter(p.value<0.05)%>%
group_by(term)%>%
summarise(EstMed=median(estimate),n=n(),Pval=median(p.value))
View(pval)
modelsTempSI<-df%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country,City)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+StringencyIndex+PRCP+ logCase, data = .x)))
pval<-modelsTempSI%>%
filter(p.value<0.05)%>%
group_by(term)%>%
summarise(EstMed=median(estimate),n=n(),Pval=median(p.value))
p<-modelsTempSI%>%
group_by(term)%>%
tally(p.value<0.05)
View(pval)
modelsTempSI<-df%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country,City)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+PRCP+ logCase, data = .x)))
modelsTempSI<-df%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country,City)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+PRCP+ logCase, data = .x)))
medn1<-modelsTempSI%>%
filter(term=="logCase")%>%
dplyr::select(estimate)
pval<-modelsTempSI%>%
filter(p.value<0.05)%>%
group_by(term)%>%
summarise(EstMed=median(estimate),n=n(),Pval=median(p.value))
View(pval)
modelsTempSI<-df%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country,City)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+StringencyIndex+PRCP+ logCase, data = .x)))
modelsTempSI<-df%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country,City)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+StringencyIndex+PRCP+ logCase, data = .x)))
medn1<-modelsTempSI%>%
filter(term=="logCase")%>%
dplyr::select(estimate)
medn1<-modelsTempSI%>%
filter(term=="logCase")%>%
dplyr::select(estimate)
pval<-modelsTempSI%>%
filter(p.value<0.05)%>%
group_by(term)%>%
summarise(EstMed=median(estimate),n=n(),Pval=median(p.value))
View(pval)
modelsTempSI<-df%>%
filter(!is.na(Temp_C),!is.na(Movement))%>%
group_by(Country,City)%>%
group_modify(~ broom::tidy(lm(Movement ~ Temp_C+StringencyIndex+PRCP+ ConfirmedCases, data = .x)))
pval<-modelsTempSI%>%
filter(p.value<0.05)%>%
group_by(term)%>%
summarise(EstMed=median(estimate),n=n(),Pval=median(p.value))
View(pval)
write_rds(df,"CityLevel_DoARDL.rds")
pi
d<-6/pi
d
ds<-5.5/pi
ds
dss<-5/pi
