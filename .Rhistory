group_by(City)%>%
summarise(Move=mean(Movement))
View(short)
summary(short$Move)
short<-mobility_regional%>%
group_by(Country,City)%>%
summarise(Move=mean(Movement))
View(short)
summary(short$Move)
short$Location<-apply(short[,c("City","Country")],1,paste,collapse=", ")
View(short)
x<-short[1:3,]
loc<-mutate_geocode(x,Location)
View(x)
x
loc<-mutate_geocode(short,Location)
View(loc)
x<-merge(mobility_regional,loc,by=c("Country","City"),all=T)
View(x)
setwd("C:/Users/fores/OneDrive - The University of Nottingham/GitHub/COVID-19/Google")
write.csv(loc,"GoogleMobGeo.csv")
?left_join
mobility_regional <- read.csv("Google/Global_Mobility_Report.csv")%>%
rename(City=sub_region_1)%>%
mutate(City=iconv(City,from="UTF-8",to="ASCII//TRANSLIT"))%>%
filter(!City=="")%>%
#filter(sub_region_1%in%cities$City1|sub_region_1%in%cities$City2)%>%
mutate(Date=as.Date(date))%>%
mutate(Country=countrycode(country_region_code,'iso2c','country.name')) %>%
mutate(Country=replace(Country, is.na(country_region_code), 'Namibia')) %>%
mutate(Movement=rowMeans(.[,c("retail_and_recreation_percent_change_from_baseline",
"grocery_and_pharmacy_percent_change_from_baseline",
"parks_percent_change_from_baseline",
"transit_stations_percent_change_from_baseline",
"workplaces_percent_change_from_baseline")],na.rm=T))%>%
dplyr::group_by(Country,City,date)%>%
#dplyr::summarise(Movement=mean(Movement))
dplyr::summarise_at(vars("retail_and_recreation_percent_change_from_baseline":"Movement"),
mean,na.rm=T)%>%
left_join(loc,by="Country","City")
setwd("C:/Users/fores/OneDrive - The University of Nottingham/GitHub/COVID-19")
mobility_regional <- read.csv("Google/Global_Mobility_Report.csv")%>%
rename(City=sub_region_1)%>%
mutate(City=iconv(City,from="UTF-8",to="ASCII//TRANSLIT"))%>%
filter(!City=="")%>%
#filter(sub_region_1%in%cities$City1|sub_region_1%in%cities$City2)%>%
mutate(Date=as.Date(date))%>%
mutate(Country=countrycode(country_region_code,'iso2c','country.name')) %>%
mutate(Country=replace(Country, is.na(country_region_code), 'Namibia')) %>%
mutate(Movement=rowMeans(.[,c("retail_and_recreation_percent_change_from_baseline",
"grocery_and_pharmacy_percent_change_from_baseline",
"parks_percent_change_from_baseline",
"transit_stations_percent_change_from_baseline",
"workplaces_percent_change_from_baseline")],na.rm=T))%>%
dplyr::group_by(Country,City,date)%>%
#dplyr::summarise(Movement=mean(Movement))
dplyr::summarise_at(vars("retail_and_recreation_percent_change_from_baseline":"Movement"),
mean,na.rm=T)%>%
left_join(loc,by="Country","City")
View(mobility_regional)
mobility_regional <- read.csv("Google/Global_Mobility_Report.csv")%>%
rename(City=sub_region_1)%>%
mutate(City=iconv(City,from="UTF-8",to="ASCII//TRANSLIT"))%>%
filter(!City=="")%>%
#filter(sub_region_1%in%cities$City1|sub_region_1%in%cities$City2)%>%
mutate(Date=as.Date(date))%>%
mutate(Country=countrycode(country_region_code,'iso2c','country.name')) %>%
mutate(Country=replace(Country, is.na(country_region_code), 'Namibia')) %>%
mutate(Movement=rowMeans(.[,c("retail_and_recreation_percent_change_from_baseline",
"grocery_and_pharmacy_percent_change_from_baseline",
"parks_percent_change_from_baseline",
"transit_stations_percent_change_from_baseline",
"workplaces_percent_change_from_baseline")],na.rm=T))%>%
dplyr::group_by(Country,City,date)%>%
#dplyr::summarise(Movement=mean(Movement))
dplyr::summarise_at(vars("retail_and_recreation_percent_change_from_baseline":"Movement"),
mean,na.rm=T)
mobility_regional <- read.csv("Google/Global_Mobility_Report.csv")%>%
rename(City=sub_region_1)%>%
mutate(City=iconv(City,from="UTF-8",to="ASCII//TRANSLIT"))%>%
filter(!City=="")%>%
#filter(sub_region_1%in%cities$City1|sub_region_1%in%cities$City2)%>%
mutate(Date=as.Date(date))%>%
mutate(Country=countrycode(country_region_code,'iso2c','country.name')) %>%
mutate(Country=replace(Country, is.na(country_region_code), 'Namibia')) %>%
mutate(Movement=rowMeans(.[,c("retail_and_recreation_percent_change_from_baseline",
"grocery_and_pharmacy_percent_change_from_baseline",
"parks_percent_change_from_baseline",
"transit_stations_percent_change_from_baseline",
"workplaces_percent_change_from_baseline")],na.rm=T))%>%
dplyr::group_by(Country,City,date)%>%
#dplyr::summarise(Movement=mean(Movement))
dplyr::summarise_at(vars("retail_and_recreation_percent_change_from_baseline":"Movement"),
mean,na.rm=T)%>%
left_join(loc,by=c("Country","City"))
View(mobility_regional)
#Lat is in left df, lat_min is in right. We want Lat to be '>=' than Lat_min...etc
briq_coord_pop<-
fuzzy_left_join(briq_coord, city2,
by=c("Lat"="Lat_min", "Lat"="Lat_max","Lon"="Lon_min","Lon"="Lon_max"),
match_fun=list(`>=`, `<=`,`>=`,`<=`))
View(briq_coord_pop)
GooBriq<-
fuzzy_left_join(mobility_regional, briq_coord_pop,
by=c("lat"="Lat_min", "lat"="Lat_max","lon"="Lon_min","lon"="Lon_max"),
match_fun=list(`>=`, `<=`,`>=`,`<=`))
BriqGoo<-
fuzzy_left_join(mobility_regional, briq_coord_pop,
by=c("lat"="Lat_min", "lat"="Lat_max","lon"="Lon_min","lon"="Lon_max"),
match_fun=list(`>=`, `<=`,`>=`,`<=`))
BriqGoo<-
fuzzy_right_join(mobility_regional, briq_coord_pop,
by=c("lat"="Lat_min", "lat"="Lat_max","lon"="Lon_min","lon"="Lon_max"),
match_fun=list(`>=`, `<=`,`>=`,`<=`))
c<-mobility_regional%>%
filter(Country=="Greece")
BriqGoo<-
fuzzy_right_join(c, briq_coord_pop,
by=c("lat"="Lat_min", "lat"="Lat_max","lon"="Lon_min","lon"="Lon_max"),
match_fun=list(`>=`, `<=`,`>=`,`<=`))
View(BriqGoo)
View(c)
View(BriqGoo)
c<-mobility_regional%>%
filter(Country %in% briq_coord$Country)
BriqGoo<-
fuzzy_right_join(c, briq_coord_pop,
by=c("lat"="Lat_min", "lat"="Lat_max","lon"="Lon_min","lon"="Lon_max"),
match_fun=list(`>=`, `<=`,`>=`,`<=`))
View(BriqGoo)
BriqGoo_inner<-
fuzzy_inner_join(c, briq_coord_pop,
by=c("lat"="Lat_min", "lat"="Lat_max","lon"="Lon_min","lon"="Lon_max"),
match_fun=list(`>=`, `<=`,`>=`,`<=`))
GooBriq<-
fuzzy_left_join(mobility_regional, briq_coord_pop,
by=c("lat"="Lat_min", "lat"="Lat_max","lon"="Lon_min","lon"="Lon_max"),
match_fun=list(`>=`, `<=`,`>=`,`<=`))
View(BriqGoo_inner)
BriqGoo<-BriqGoo_inner
View(BriqGoo_inner)
BriqGoo%>%
group_by(Country)%>%
summarise(n())
BriqGoo%>%
group_by(Country)%>%
summarise(n()/130)
BriqGoo%>%
group_by(Country)%>%
summarise(nrow/130)
q<-BriqGoo%>%
group_by(Country)%>%
summarise(nrow()/130)
q<-BriqGoo%>%
group_by(Country)%>%
summarise(n()/130)
q$Country
View(q)
US<-BriqGoo%>%
filter(Country=="United States")
View(social_prefs_city)
View(US)
View(BriqGoo)
levels(US$City)
US$City
View(US)
BriqGoo$latitude
briq_coord_pop<-briq_coord_pop
briq_coord_pop<-briq_coord_pop%>%
mutate(Lat_min_4=latitude-0.4,
Lat_max_4=latitude+0.4,
Lon_min_4=longitude-0.4,
Lon_max_4=longitude+0.4)
View(briq_coord_pop)
BriqGoo<-
fuzzy_inner_join(c, briq_coord_pop,
by=c("lat"="Lat_min_4", "lat"="Lat_max_4","lon"="Lon_min_4","lon"="Lon_max_4"),
match_fun=list(`>=`, `<=`,`>=`,`<=`))
q<-BriqGoo%>%
group_by(Country)%>%
summarise(n()/130)
View(q)
qc<-q%>%
group_by(Country)%>%
summarise(n()/130)
View(qc)
qc<-c%>%
group_by(Country)%>%
summarise(n()/130)
View(qc)
source("ImportLong.r")
df%>%
group_by(Country)%>%
summarise(n())
View(df)
df$Wave
df%>%
group_by(Country)%>%
summarise(n())%>%
filter(!is.na(Movement))
df%>%
filter(!is.na(Movement))%>%
group_by(Country)%>%
summarise(n())
df%>%
filter(!is.na(Movement),!is.na(risktaking))%>%
group_by(Country)%>%
summarise(n())
z<-df%>%
filter(!is.na(Movement),!is.na(risktaking))%>%
group_by(Country)%>%
summarise(n())
briq_coord%>%group_by(Country)%>%summarise(n())
s<-df%>%
dplyr::select(Country,Movement,risktaking)
View(s)
s<-s%>%filter(!is.na(Movement),!is.na(risktaking))%>%group_by(Country)%summarise(n())
s<-s%>%filter(!is.na(Movement),!is.na(risktaking))%>%group_by(Country)%summarise(n=n())
s<-s%>%filter(!is.na(Movement),!is.na(risktaking))
s%>%group_by(Country)%>%summarise(n())
s
View(s)
s<-df%>%
dplyr::select(Country,Movement,risktaking)
s<-s%>%filter(!is.na(Movement),!is.na(risktaking))
mobility_regional%>%group_by(Country)%>%summarise(n())
mobility%>%group_by(Country)%>%summarise(n())
source("Import_mobility.r")
getwd()
source("import_mobility.r")
source("Google/import_mobility.r")
mobility%>%group_by(Country)%>%summarise(n())
cl<-mobility_regional%>%
group_by(Country)%>%
summarise(n())
cc<-mobility%>%
group_by(Country)%>%
summarise(n())
missing<-merge(cc,cl,by="Country",all=T)
print(is.na(missing$n().y))
print(is.na(missing$`n().y`)
)
print(cbind(missing$Countrymis.na(missing$`n().y`))
print(cbind(missing$Countrymis.na(missing$`n().y`))
)
print(cbind(missing$Country,mis.na(missing$`n().y`))
print(cbind(missing$Country,mis.na(missing$`n().y`))
)
print(cbind(missing$Country,na(missing$`n().y`))
)
print(cbind(missing$Country,is.na(missing$`n().y`))
)
print(cbind(missing$Country,is.na(missing$`n().y`)==TRUE)
)
View(mobility_regional)
View(mobility)
knitr::opts_chunk$set(echo = TRUE)
```{r echo = FALSE, message=FALSE, warning=FALSE}
mobility%>%
anti_join(mobility_regional,by="Country")
z<-mobility%>%
anti_join(mobility_regional,by="Country")
z<-mobility%>%
anti_join(mobility_regional,by="Country")%>%
group_by(Country)%>%
summarise(n())
View(z)
mobility%>%
anti_join(mobility_regional,by="Country")%>%
group_by(Country)%>%
summarise(n())
mobility%>%
anti_join(mobility_regional,by="Country")%>%
group_by(Country)%>%
summarise(n())
print(mobility%>%
anti_join(mobility_regional,by="Country")%>%
group_by(Country)%>%
summarise(n()))
mobility%>%
anti_join(mobility_regional,by="Country")%>%
group_by(Country)%>%
summarise(n())%>%
print()
mobility%>%
anti_join(mobility_regional,by="Country")%>%
group_by(Country)%>%
summarise(n())%>%
print(Country)
print(z$Country)
nrow(z)
z2<-df%>%
filter(!is.na(Movement),!is.na(StringencyIndex),!is.na(risktaking))%>%
anti_join(mobility_regional,by="Country")%>%
group_by(Country)%>%
summarise(n())
print(z2)
print(z2$Country)
nrow(z2$Country)
nrow(z2)
nrow(z)
df_short<-df%>%
group_by(Country)%>%
summarise(n())
filter(!is.na(Movement),!is.na(StringencyIndex),!is.na(risktaking)%>%
df_short<-df%>%
filter(!is.na(Movement),!is.na(StringencyIndex),!is.na(risktaking))%>%
group_by(Country)%>%
summarise(n())
nrow(df_short)
View(q)
antiC<-c%>%
anti_join(BriqGoo,by="Country")%>%
group_by(Country)%>%
summarise(n())
antiC$Country
c1<-c%>%
filter(Country %in% antiC$Country)
View(c1)
c1<-c%>%
filter(Country %in% antiC$Country)%>%
group_by(Country,City)%>%
summarise(lt=mean(lat),lon=mean(lon))
View(c1)
b1<-BriqGoo%>%
filter(Country %in% antiC$Country)%>%
group_by(Country,City)%>%
summarise(lt=mean(latitude),lon=mean(longitude))
b1<-BriqGoo%>%
filter(Country %in% antiC$Country)%>%
group_by(Country,City.x)%>%
summarise(lt=mean(latitude),lon=mean(longitude))
b1<-BriqGoo%>%
filter(Country %in% antiC$Country)
b1<-BriqGoo%>%
filter(Country %in% c1$Country)%>%
group_by(Country,City.x)%>%
summarise(lt=mean(latitude),lon=mean(longitude))
b1<-briq_coord_pop%>%
filter(Country %in% c1$Country)%>%
group_by(Country,City.x)%>%
summarise(lt=mean(latitude),lon=mean(longitude))
b1<-briq_coord_pop%>%
filter(Country.x %in% c1$Country)%>%
group_by(Country.x,City.x)%>%
summarise(lt=mean(latitude),lon=mean(longitude))
b1<-briq_coord_pop%>%
filter(Country.x %in% c1$Country)%>%
group_by(Country.x,City)%>%
summarise(lt=mean(latitude),lon=mean(longitude))
c1<-c%>%
filter(Country %in% antiC$Country)%>%
group_by(Country,City)%>%
summarise(lt=mean(lat),lon=mean(lon))
View(b1)
b1<-briq_coord_pop%>%
filter(Country.x %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(location)%>%
summarise(lt=mean(latitude),lon=mean(longitude))
b1<-briq_coord_pop%>%
filter(Country.x %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(Location)%>%
summarise(lt=mean(latitude),lon=mean(longitude))
b1
geocode(Toronto CMA , Canada)
geocode("Toronto CMA , Canada")
b1<-briq_coord_pop%>%
# filter(Country.x %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(Location)%>%
summarise(lt=mean(latitude),lon=mean(longitude))
geocode("	Abruzzo, Italy")
#It appears that many cities in Briq_coord_pop do not have geocedes. Maybe due to the mergure with cities
b2<-briq_coord%>%
filter(Country %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(Location)%>%
summarise(lt=mean(latitude),lon=mean(longitude))
b1<-briq_coord_pop%>%
# filter(Country.x %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(Location)%>%
summarise(lt=mean(Lat),lon=mean(Lon))
#It appears that many cities in Briq_coord_pop do not have geocedes. Maybe due to the mergure with cities
b2<-briq_coord%>%
filter(Country %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(Location)%>%
summarise(lt=mean(Lat),lon=mean(Lon))
View(b2)
View(briq_coord_pop)
briq_coord_pop<-briq_coord_pop%>%
mutate(Lat_min_4=Lat-0.4,
Lat_max_4=Lat+0.4,
Lon_min_4=Lon-0.4,
Lon_max_4=Lon+0.4)
View(briq_coord_pop)
BriqGoo<-
fuzzy_inner_join(c, briq_coord_pop,
by=c("lat"="Lat_min_4", "lat"="Lat_max_4","lon"="Lon_min_4","lon"="Lon_max_4"),
match_fun=list(`>=`, `<=`,`>=`,`<=`))
c<-mobility_regional%>%
filter(Country %in% briq_coord$Country)
briq_coord_pop<-briq_coord_pop%>%
mutate(Lat_min_4=Lat-0.2,
Lat_max_4=Lat+0.2,
Lon_min_4=Lon-0.2,
Lon_max_4=Lon+0.2)
BriqGoo<-
fuzzy_inner_join(c, briq_coord_pop,
by=c("lat"="Lat_min", "lat"="Lat_max","lon"="Lon_min","lon"="Lon_max"),
match_fun=list(`>=`, `<=`,`>=`,`<=`))
antiC<-c%>%
anti_join(BriqGoo,by="Country")%>%
group_by(Country)%>%
summarise(n())
antiC$Country
c1<-c%>%
filter(Country %in% antiC$Country)%>%
group_by(Country,City)%>%
summarise(lt=mean(lat),lon=mean(lon))
b1<-briq_coord_pop%>%
# filter(Country.x %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(Location)%>%
summarise(lt=mean(latitude),lon=mean(longitude))
#It appears that many cities in Briq_coord_pop do not have geocedes. Maybe due to the mergure with cities
b2<-briq_coord%>%
filter(Country %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(Location)%>%
summarise(lt=mean(Lat),lon=mean(Lon))
View(b2)
q<-BriqGoo%>%
group_by(Country)%>%
summarise(n()/130)
q$Country
View(q)
antiC<-c%>%
anti_join(BriqGoo,by="Country")%>%
group_by(Country)%>%
summarise(n())
antiC$Country
b1<-briq_coord_pop%>%
# filter(Country.x %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(Location)%>%
summarise(lt=mean(Lat),lon=mean(Lon))
#It appears that many cities in Briq_coord_pop do not have geocedes. Maybe due to the mergure with cities
b2<-briq_coord%>%
filter(Country %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(Country,City)%>%
summarise(lt=mean(Lat),lon=mean(Lon),loc=first(Location))
b1<-briq_coord_pop%>%
# filter(Country.x %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(Location)%>%
summarise(lt=mean(Lat),lon=mean(Lon),loc=first(Location))
b1<-briq_coord_pop%>%
# filter(Country.x %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(Country,City)%>%
summarise(lt=mean(Lat),lon=mean(Lon),loc=first(Location))
b1<-briq_coord_pop%>%
# filter(Country.x %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(Country,City)%>%
summarise(lt=mean(Lat),lon=mean(Lon),loc=first(Location))
b1<-briq_coord_pop%>%
# filter(Country.x %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(Country.x,City)%>%
summarise(lt=mean(Lat),lon=mean(Lon),loc=first(Location))
b1<-briq_coord_pop%>%
filter(Country.x %in% c1$Country)%>%
# group_by(Country.x,City)%>%
group_by(Country.x,City)%>%
summarise(lt=mean(Lat),lon=mean(Lon),loc=first(Location))
antiC<-c%>%
anti_join(BriqGoo,by="Country")%>%
group_by(Country)%>%
summarise(n())
antiC$Country
View(BriqGoo)
View(briq_coord_pop)
geocede("Ontario")
geocode("Ontario")
geocode("Ontario, excl Toronto, Canada	")
?geocode
?ggmap
?st_as_sf()
get_googlemap(center = c(8.4, 49.5), zoom = 6)f
get_googlemap(center = c(8.4, 49.5), zoom = 6)
revgeocode(c(lon=-79.4,lat=43.7))
geocode("Toronto")
geocode("Ontario")
geocode("CA-AB")
geocode("Alberta")
geocode("Alberta, Canada")
geocode("Ontario, excl Toronto")
geocode("Toronto")
geocode("Ontario")
View(BriqGoo)
View(briq_coord_pop)
View(c)
BriqGoo<-
fuzzy_inner_join(c, briq_coord_pop,
by=c("Country"="Country.x","lat"="Lat_min_4", "lat"="Lat_max_4","lon"="Lon_min_4","lon"="Lon_max_4"),
match_fun=list(`==`,`>=`, `<=`,`>=`,`<=`))
